<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Leitor de Texto</title>
</head>
<body>
  <h2>üîä Leitor de Texto com Controles</h2>

  <textarea id="texto" rows="15" cols="80" placeholder="Cole seu texto aqui..."></textarea><br><br>

  <label for="voz">Voz: </label>
  <select id="voz"></select><br><br>

  <label for="velocidade">Velocidade da fala: </label>
  <input type="range" id="velocidade" min="0.5" max="2" value="1" step="0.1"><br><br>

  <button onclick="lerTexto()">‚ñ∂Ô∏è Ler</button>
  <button onclick="pausarOuRetomar()">‚è∏Ô∏è Pausar/Retomar</button>
  <button onclick="pararLeitura()">‚èπÔ∏è Parar</button>

  <h3>Frase sendo lida agora:</h3>
  <div id="frase-atual" style="border: 1px solid #ccc; padding: 10px; min-height: 40px; max-width: 800px; background:#f9f9f9;">
  </div>

  <script>
    let utterance = null;
    let isPaused = false;
    let frases = [];
    let indiceFraseAtual = 0;
    let vozesDisponiveis = [];

    function carregarVozes() {
      vozesDisponiveis = speechSynthesis.getVoices();
      const selectVoz = document.getElementById("voz");
      selectVoz.innerHTML = "";

      const vozSalva = localStorage.getItem("vozSelecionada");

      vozesDisponiveis.forEach((voz, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = `${voz.name} (${voz.lang})`;

        // Se houver voz salva, seleciona ela
        if (vozSalva !== null && parseInt(vozSalva, 10) === index) {
          option.selected = true;
        }

        selectVoz.appendChild(option);
      });

      // Se n√£o houver voz salva, tenta selecionar a primeira em portugu√™s
      if (vozSalva === null) {
        for (let i = 0; i < vozesDisponiveis.length; i++) {
          if (vozesDisponiveis[i].lang.toLowerCase().startsWith("pt")) {
            selectVoz.value = i;
            break;
          }
        }
      }
    }

    // Salva voz quando usu√°rio troca
    document.addEventListener("change", function(e) {
      if (e.target.id === "voz") {
        localStorage.setItem("vozSelecionada", e.target.value);
      }
    });

    function atualizarFraseAtual() {
      const visor = document.getElementById("frase-atual");
      if (frases.length > 0 && indiceFraseAtual < frases.length) {
        visor.textContent = frases[indiceFraseAtual];
      } else {
        visor.textContent = "";
      }
    }

    function lerTexto() {
      const texto = document.getElementById("texto").value.trim();
      const velocidade = parseFloat(document.getElementById("velocidade").value);
      const selectVoz = document.getElementById("voz");
      const indiceVoz = parseInt(selectVoz.value, 10);

      if (!texto) return;

      if (speechSynthesis.speaking || speechSynthesis.paused) {
        speechSynthesis.cancel();
      }

      frases = texto
        .split(/(?<=[\.\!\?\‚Ä¶])\s+/)
        .filter(f => f.length > 0);

      indiceFraseAtual = 0;
      isPaused = false;

      function falarFrase(indice) {
        if (indice >= frases.length) {
          indiceFraseAtual = frases.length;
          atualizarFraseAtual();
          return;
        }

        utterance = new SpeechSynthesisUtterance(frases[indice]);
        utterance.rate = velocidade;

        if (vozesDisponiveis[indiceVoz]) {
          utterance.voice = vozesDisponiveis[indiceVoz];
        }

        atualizarFraseAtual();

        utterance.onend = () => {
          if (!speechSynthesis.paused) {
            indiceFraseAtual++;
            falarFrase(indiceFraseAtual);
          }
        };

        speechSynthesis.speak(utterance);
      }

      falarFrase(indiceFraseAtual);
    }

    function pausarOuRetomar() {
      if (speechSynthesis.speaking || speechSynthesis.paused) {
        if (isPaused) {
          speechSynthesis.resume();
          isPaused = false;
        } else {
          speechSynthesis.pause();
          isPaused = true;
        }
      }
    }

    function pararLeitura() {
      speechSynthesis.cancel();
      isPaused = false;
      frases = [];
      indiceFraseAtual = 0;
      atualizarFraseAtual();
    }

    window.addEventListener("load", carregarVozes);
    speechSynthesis.addEventListener("voiceschanged", carregarVozes);
  </script>
</body>
</html>
