<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Leitor de Texto</title>
</head>
<body>
  <h2>üîä Leitor de Texto com Controles</h2>

  <!-- √Årea de texto original -->
  <textarea id="texto" rows="15" cols="80" placeholder="Cole seu texto aqui..."></textarea><br><br>

  <!-- NOVO: sele√ß√£o de voz -->
  <label for="voz">Voz: </label>
  <select id="voz"></select><br><br>

  <label for="velocidade">Velocidade da fala: </label>
  <input type="range" id="velocidade" min="0.5" max="2" value="1" step="0.1"><br><br>

  <button onclick="lerTexto()">‚ñ∂Ô∏è Ler</button>
  <button onclick="pausarOuRetomar()">‚è∏Ô∏è Pausar/Retomar</button>
  <button onclick="pararLeitura()">‚èπÔ∏è Parar</button>

  <!-- NOVO: visor da frase atual -->
  <h3>Frase sendo lida agora:</h3>
  <div id="frase-atual" style="border: 1px solid #ccc; padding: 10px; min-height: 40px; max-width: 800px; background:#f9f9f9;">
    <!-- A frase atual aparece aqui -->
  </div>

  <script>
    let utterance = null;
    let isPaused = false;
    let frases = [];
    let indiceFraseAtual = 0;
    let vozesDisponiveis = [];

    // Carrega as vozes dispon√≠veis e preenche o <select>
    function carregarVozes() {
      vozesDisponiveis = speechSynthesis.getVoices();
      const selectVoz = document.getElementById("voz");
      selectVoz.innerHTML = "";

      vozesDisponiveis.forEach((voz, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = `${voz.name} (${voz.lang})`;

        // Tenta selecionar automaticamente a primeira voz em portugu√™s
        if (voz.lang.toLowerCase().startsWith("pt") && !selectVoz.dataset.ptSelecionada) {
          option.selected = true;
          selectVoz.dataset.ptSelecionada = "true";
        }

        selectVoz.appendChild(option);
      });
    }

    // Atualiza a caixa que mostra a frase atual
    function atualizarFraseAtual() {
      const visor = document.getElementById("frase-atual");
      if (frases.length > 0 && indiceFraseAtual < frases.length) {
        visor.textContent = frases[indiceFraseAtual];
      } else {
        visor.textContent = "";
      }
    }

    // L√™ o texto em frases, uma por vez
    function lerTexto() {
      const texto = document.getElementById("texto").value.trim();
      const velocidade = parseFloat(document.getElementById("velocidade").value);
      const selectVoz = document.getElementById("voz");
      const indiceVoz = parseInt(selectVoz.value, 10);

      if (!texto) return;

      // Interrompe qualquer fala anterior
      if (speechSynthesis.speaking || speechSynthesis.paused) {
        speechSynthesis.cancel();
      }

      // Quebra o texto em frases usando pontua√ß√£o
      frases = texto
        .split(/(?<=[\.\!\?\‚Ä¶])\s+/)
        .filter(f => f.length > 0);

      indiceFraseAtual = 0;
      isPaused = false;

      function falarFrase(indice) {
        if (indice >= frases.length) {
          // Terminou todas as frases
          indiceFraseAtual = frases.length;
          atualizarFraseAtual();
          return;
        }

        utterance = new SpeechSynthesisUtterance(frases[indice]);
        utterance.lang = "pt-BR";
        utterance.rate = velocidade;

        if (vozesDisponiveis[indiceVoz]) {
          utterance.voice = vozesDisponiveis[indiceVoz];
        }

        // Atualiza o visor com a frase atual
        atualizarFraseAtual();

        utterance.onend = () => {
          // Se n√£o estiver pausado, avan√ßa para a pr√≥xima frase
          if (!speechSynthesis.paused) {
            indiceFraseAtual++;
            falarFrase(indiceFraseAtual);
          }
        };

        speechSynthesis.speak(utterance);
      }

      falarFrase(indiceFraseAtual);
    }

    function pausarOuRetomar() {
      if (speechSynthesis.speaking || speechSynthesis.paused) {
        if (isPaused) {
          speechSynthesis.resume();
          isPaused = false;
        } else {
          speechSynthesis.pause();
          isPaused = true;
        }
      }
    }

    function pararLeitura() {
      speechSynthesis.cancel();
      isPaused = false;
      frases = [];
      indiceFraseAtual = 0;
      atualizarFraseAtual();
    }

    // Eventos para carregar as vozes
    window.addEventListener("load", carregarVozes);
    speechSynthesis.addEventListener("voiceschanged", carregarVozes);
  </script>
</body>
</html>
